---
import Head from '../components/Head.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description: string;
  canonicalURL?: string;
  ogImage?: string;
}

const { title, description, canonicalURL, ogImage } = Astro.props;
---

<html lang="en">
  <head>
    <Head title={title} description={description} canonicalURL={canonicalURL} ogImage={ogImage} />
  </head>
  <body>
    <canvas id="grain" aria-hidden="true"></canvas>
    <Header />
    <main>
      <slot />
    </main>
    <Footer />
    <script>
      const canvas = document.getElementById('grain') as HTMLCanvasElement;
      const ctx = canvas.getContext('2d')!;
      const scale = 3; // Render at 1/3 res for chunky CRT look + perf

      function resize() {
        canvas.width = Math.ceil(window.innerWidth / scale);
        canvas.height = Math.ceil(window.innerHeight / scale);
      }

      resize();
      window.addEventListener('resize', resize);

      const fps = 14; // ~14fps for lazy CRT phosphor persistence feel
      const interval = 1000 / fps;
      let last = 0;

      (function loop(now: number) {
        requestAnimationFrame(loop);
        if (now - last < interval) return;
        last = now;

        const w = canvas.width;
        const h = canvas.height;
        const idata = ctx.createImageData(w, h);
        const buffer32 = new Uint32Array(idata.data.buffer);

        for (let i = 0; i < buffer32.length; i++) {
          buffer32[i] = ((255 * Math.random()) | 0) << 24 | 0x00FFFFFF;
        }

        ctx.putImageData(idata, 0, 0);
      })(0);
    </script>
  </body>
</html>

<style>
  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
</style>
